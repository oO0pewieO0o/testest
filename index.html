<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Outfit Combo Quest â€” Enhanced Edition</title>
  
  <!-- Enhanced Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Outfit:wght@400;700;800;900&display=swap" rel="stylesheet">
  
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* ========== CSS VARIABLES ========== */
    :root {
      /* Enhanced Color Palette */
      --bg-gradient: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #000000 100%);
      
      /* Glass Morphism */
      --glass-surface: rgba(28, 28, 28, 0.85);
      --glass-border: rgba(100, 100, 100, 0.25);
      --glass-blur: blur(20px);
      
      /* Neon Colors with expanded palette */
      --primary: #3b82f6;
      --primary-glow: rgba(59, 130, 246, 0.5);
      --accent: #0ea5e9;
      --highlight: #60a5fa;
      --success: #10b981;
      --success-glow: rgba(16, 185, 129, 0.4);
      --danger: #ef4444;
      --warning: #f59e0b;
      --vibrant: #8b5cf6;
      
      /* Text Colors */
      --text-main: #f3f4f6;
      --text-muted: #9ca3af;
      --text-bright: #ffffff;
      
      /* Backgrounds */
      --slot-bg: #111111;
      --slot-border: rgba(255, 255, 255, 0.1);
      --slot-hover: rgba(96, 165, 250, 0.15);
      
      /* UI Elements - Responsive Sizing */
      --radius-xl: clamp(24px, 2vw, 32px);
      --radius-lg: clamp(20px, 1.8vw, 24px);
      --radius-md: clamp(14px, 1.2vw, 16px);
      --radius-sm: clamp(10px, 1vw, 12px);
      --radius-xs: clamp(6px, 0.8vw, 8px);
      
      /* Responsive Shadows */
      --shadow-lg: 0 clamp(15px, 2vw, 25px) clamp(35px, 4vw, 60px) clamp(-10px, 1vw, -15px) rgba(0,0,0,0.9);
      --shadow-md: 0 clamp(10px, 1.5vw, 15px) clamp(25px, 3vw, 40px) clamp(-8px, 0.8vw, -10px) rgba(0,0,0,0.7);
      --shadow-sm: 0 clamp(5px, 0.8vw, 8px) clamp(15px, 2vw, 25px) clamp(-3px, 0.5vw, -5px) rgba(0,0,0,0.5);
      --shadow-glow: 0 0 clamp(20px, 2vw, 30px) rgba(59, 130, 246, 0.4);
      --shadow-accent: 0 0 clamp(15px, 1.8vw, 25px) rgba(14, 165, 233, 0.4);
      
      /* Spacing - Responsive */
      --space-xs: clamp(4px, 0.5vw, 8px);
      --space-sm: clamp(8px, 1vw, 12px);
      --space-md: clamp(12px, 1.5vw, 16px);
      --space-lg: clamp(16px, 2vw, 24px);
      --space-xl: clamp(24px, 3vw, 32px);
      --space-2xl: clamp(32px, 4vw, 48px);
      
      /* Font Sizes - Responsive */
      --text-xs: clamp(0.75rem, 0.8vw, 0.875rem);
      --text-sm: clamp(0.875rem, 1vw, 1rem);
      --text-base: clamp(1rem, 1.2vw, 1.125rem);
      --text-lg: clamp(1.125rem, 1.4vw, 1.25rem);
      --text-xl: clamp(1.25rem, 1.6vw, 1.5rem);
      --text-2xl: clamp(1.5rem, 2vw, 1.875rem);
      --text-3xl: clamp(1.875rem, 2.5vw, 2.25rem);
      --text-4xl: clamp(2.25rem, 3vw, 3rem);
    }

    /* ========== RESET & BASE ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      font-size: 100%;
      -webkit-text-size-adjust: 100%;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg-gradient);
      background-attachment: fixed;
      color: var(--text-main);
      min-height: 100vh;
      min-height: 100dvh; /* Dynamic viewport height for mobile */
      overflow-x: hidden;
      position: relative;
      font-size: var(--text-base);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ========== ANIMATED BACKGROUND ========== */
    .bg-effects {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -2;
      pointer-events: none;
    }

    .bg-glow-1 {
      position: absolute;
      top: 10%;
      left: 5%;
      width: min(60vw, 600px);
      height: min(60vw, 600px);
      background: radial-gradient(circle, rgba(59, 130, 246, 0.15) 0%, transparent 70%);
      filter: blur(clamp(40px, 6vw, 60px));
      animation: float-1 20s ease-in-out infinite alternate;
    }

    .bg-glow-2 {
      position: absolute;
      bottom: 5%;
      right: 10%;
      width: min(50vw, 500px);
      height: min(50vw, 500px);
      background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%);
      filter: blur(clamp(50px, 7vw, 70px));
      animation: float-2 25s ease-in-out infinite alternate-reverse;
    }

    .bg-glow-3 {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: min(40vw, 400px);
      height: min(40vw, 400px);
      background: radial-gradient(circle, rgba(14, 165, 233, 0.08) 0%, transparent 70%);
      filter: blur(clamp(40px, 5vw, 50px));
      animation: pulse 10s ease-in-out infinite;
    }

    /* Stars Effect */
    .stars {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -3;
      pointer-events: none;
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle var(--duration) ease-in-out infinite;
    }

    /* ========== TYPOGRAPHY ========== */
    h1, h2, h3, h4 {
      font-family: 'Outfit', sans-serif;
      margin: 0;
      font-weight: 800;
      letter-spacing: 0.02em;
      color: var(--text-bright);
      line-height: 1.2;
    }

    h1 { 
      font-size: var(--text-4xl);
      text-shadow: 0 clamp(2px, 0.3vw, 4px) clamp(10px, 1.5vw, 20px) rgba(0,0,0,0.7);
    }
    
    h2 { 
      font-size: var(--text-3xl);
      margin-bottom: var(--space-lg);
    }
    
    h3 { 
      font-size: var(--text-2xl);
      margin-bottom: var(--space-md);
    }
    
    h4 { 
      font-size: var(--text-xl);
      margin-bottom: var(--space-sm);
    }

    p {
      line-height: 1.7;
      color: var(--text-muted);
      margin-bottom: var(--space-md);
    }

    a {
      color: var(--highlight);
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
    }

    a:hover {
      color: var(--accent);
      text-shadow: 0 0 15px var(--accent);
    }

    /* ========== MAIN CONTAINER ========== */
    .container {
      max-width: min(1200px, 95vw);
      margin: 0 auto;
      padding: clamp(20px, 3vw, 30px) clamp(15px, 2vw, 20px);
      position: relative;
      z-index: 1;
    }

    /* ========== HEADER ========== */
    header {
      display: flex;
      align-items: center;
      gap: clamp(20px, 3vw, 30px);
      margin-bottom: clamp(30px, 4vw, 40px);
      padding-bottom: clamp(20px, 2.5vw, 25px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      animation: slideDown 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    .logo-container {
      position: relative;
      width: clamp(80px, 10vw, 100px);
      height: clamp(80px, 10vw, 100px);
      flex-shrink: 0;
    }

    .logo-box {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1d4ed8, #0ea5e9, #8b5cf6);
      border-radius: clamp(20px, 2.5vw, 25px);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-glow);
      transform: rotate(-3deg);
      border: clamp(1px, 0.2vw, 2px) solid rgba(255, 255, 255, 0.15);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      overflow: hidden;
    }

    .logo-box::before {
      content: '';
      position: absolute;
      width: 150%;
      height: 150%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transform: translateX(-150%) rotate(45deg);
      transition: transform 0.6s ease;
    }

    .logo-box:hover {
      transform: rotate(0deg) scale(1.08);
      box-shadow: 0 0 clamp(30px, 4vw, 40px) rgba(59, 130, 246, 0.6);
    }

    .logo-box:hover::before {
      transform: translateX(150%) rotate(45deg);
    }

    .logo-box img {
      width: 70%;
      height: auto;
      filter: drop-shadow(0 clamp(4px, 0.6vw, 6px) clamp(8px, 1.2vw, 12px) rgba(0,0,0,0.5));
      pointer-events: none;
    }

    .header-content {
      flex: 1;
      min-width: 0; /* Prevents flex overflow */
    }

    .header-content h1 {
      background: linear-gradient(to right, #ffffff, var(--highlight));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: var(--space-xs);
      word-break: break-word;
      overflow-wrap: break-word;
    }

    .tagline {
      font-size: var(--text-base);
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      flex-wrap: wrap;
    }

    .tagline i {
      color: var(--accent);
    }

    /* ========== LAYOUT ========== */
    .layout {
      display: grid;
      grid-template-columns: minmax(250px, 300px) 1fr;
      gap: clamp(20px, 3vw, 30px);
      align-items: start;
    }

    /* ========== NAVIGATION ========== */
    nav.card {
      padding: 0;
      position: sticky;
      top: clamp(20px, 3vw, 30px);
      overflow: hidden;
    }

    .nav-header {
      padding: clamp(20px, 2.5vw, 25px);
      background: rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .nav-header h3 {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      color: var(--highlight);
      font-size: var(--text-lg);
    }

    .menu {
      display: flex;
      flex-direction: column;
      padding: var(--space-md);
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: clamp(12px, 1.5vw, 15px);
      padding: clamp(14px, 1.8vw, 18px) clamp(16px, 2vw, 20px);
      background: transparent;
      border: none;
      border-radius: var(--radius-md);
      color: var(--text-muted);
      font-family: 'Outfit', sans-serif;
      font-weight: 600;
      font-size: var(--text-base);
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
      margin-bottom: var(--space-xs);
      position: relative;
      overflow: hidden;
      width: 100%;
      white-space: nowrap;
    }

    .menu-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: clamp(3px, 0.4vw, 4px);
      background: var(--primary);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }

    .menu-item:hover {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-main);
      transform: translateX(clamp(6px, 0.8vw, 8px));
    }

    .menu-item:hover::before {
      transform: translateX(0);
    }

    .menu-item.active {
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.05));
      color: var(--text-bright);
      box-shadow: var(--shadow-sm);
    }

    .menu-item.active::before {
      transform: translateX(0);
    }

    .menu-item i {
      font-size: var(--text-lg);
      width: clamp(20px, 2.4vw, 24px);
      text-align: center;
      flex-shrink: 0;
    }

    .menu-item .badge {
      margin-left: auto;
      font-size: var(--text-xs);
      padding: clamp(3px, 0.4vw, 4px) clamp(8px, 1vw, 10px);
      background: var(--vibrant);
      color: white;
      border-radius: 20px;
      font-weight: 700;
      flex-shrink: 0;
    }

    /* ========== CARDS ========== */
    .card {
      background: var(--glass-surface);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: clamp(20px, 3vw, 30px);
      box-shadow: var(--shadow-lg);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg), 0 10px 30px rgba(0,0,0,0.3);
    }

    /* ========== GAME HEADER ========== */
    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(10, 10, 10, 0.6);
      padding: clamp(16px, 2vw, 20px);
      border-radius: var(--radius-lg);
      margin-bottom: clamp(20px, 3vw, 30px);
      border: 1px solid var(--glass-border);
      position: relative;
      overflow: hidden;
    }

    .game-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: clamp(3px, 0.4vw, 4px);
      background: linear-gradient(90deg, var(--primary), var(--accent));
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: clamp(15px, 2.5vw, 25px);
      width: 100%;
    }

    .stat-card {
      background: rgba(0, 0, 0, 0.3);
      border-radius: var(--radius-md);
      padding: clamp(14px, 1.8vw, 18px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-3px);
      border-color: rgba(96, 165, 250, 0.3);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }

    .stat-label {
      font-size: var(--text-sm);
      color: var(--text-muted);
      margin-bottom: var(--space-xs);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }

    .stat-value {
      font-size: clamp(1.8rem, 2.2vw, 2.2rem);
      font-weight: 800;
      font-family: 'Outfit', sans-serif;
      color: var(--text-bright);
      line-height: 1;
    }

    .stat-sub {
      font-size: var(--text-xs);
      color: var(--text-muted);
      margin-top: var(--space-xs);
    }

    /* ========== ENHANCED SLOTS ========== */
    .preview-stage {
      background: linear-gradient(180deg, rgba(28,28,28,0.6), rgba(10,10,10,0.9));
      border-radius: var(--radius-lg);
      min-height: clamp(200px, 25vh, 280px);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      margin-bottom: clamp(20px, 3vw, 30px);
      border: 1px solid var(--glass-border);
      box-shadow: inset 0 clamp(2px, 0.4vw, 4px) clamp(20px, 3vw, 30px) rgba(0,0,0,0.5);
      overflow: hidden;
    }

    .preview-stage::before {
      content: 'INVENTORY SCANNER';
      position: absolute;
      top: clamp(15px, 2vw, 20px);
      left: 50%;
      transform: translateX(-50%);
      font-weight: 800;
      color: rgba(255,255,255,0.1);
      font-size: clamp(1.2rem, 1.8vw, 1.8rem);
      letter-spacing: clamp(2px, 0.3vw, 3px);
      font-family: 'Outfit', sans-serif;
      z-index: 1;
    }

    .slots-container {
      display: flex;
      gap: clamp(15px, 2.5vw, 25px);
      z-index: 2;
      position: relative;
      width: 100%;
      justify-content: center;
      flex-wrap: wrap;
    }

    .slot {
      width: clamp(100px, 14vw, 140px);
      height: clamp(140px, 18vw, 180px);
      background: var(--slot-bg);
      border: clamp(1px, 0.2vw, 2px) solid var(--slot-border);
      border-radius: var(--radius-lg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-md);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
    }

    .slot::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, transparent 30%, rgba(96, 165, 250, 0.05) 100%);
      z-index: 1;
    }

    .slot:hover {
      transform: translateY(-10px) scale(1.05);
      border-color: var(--highlight);
      box-shadow: 0 15px 35px rgba(0,0,0,0.5), 0 0 25px rgba(96, 165, 250, 0.3);
    }

    .slot-icon {
      width: clamp(60px, 9vw, 90px);
      height: clamp(60px, 9vw, 90px);
      background: linear-gradient(135deg, #1f2937, #111827);
      color: var(--highlight);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(1.8rem, 2.5vw, 2.5rem);
      font-weight: 900;
      font-family: 'Outfit', sans-serif;
      margin-bottom: clamp(10px, 1.5vw, 15px);
      box-shadow: inset 0 clamp(2px, 0.4vw, 4px) clamp(5px, 1vw, 10px) rgba(0,0,0,0.5), 
                  0 clamp(5px, 0.8vw, 8px) clamp(15px, 2vw, 20px) rgba(0,0,0,0.4);
      z-index: 2;
      transition: all 0.3s ease;
    }

    .slot-label {
      font-size: var(--text-xs);
      text-transform: uppercase;
      letter-spacing: clamp(1px, 0.15vw, 1.5px);
      color: var(--text-muted);
      font-weight: 700;
      z-index: 2;
    }

    .slot-category {
      position: absolute;
      bottom: clamp(10px, 1.5vw, 15px);
      font-size: var(--text-xs);
      color: rgba(255,255,255,0.5);
      z-index: 2;
      text-align: center;
      width: 100%;
      padding: 0 var(--space-xs);
    }

    /* ========== CONTROLS ========== */
    .controls-bar {
      display: flex;
      flex-wrap: wrap;
      gap: clamp(10px, 1.5vw, 15px);
      align-items: center;
      padding-bottom: clamp(20px, 2.5vw, 25px);
      border-bottom: 1px dashed rgba(255,255,255,0.15);
      margin-bottom: clamp(20px, 3vw, 30px);
    }

    .btn {
      border: none;
      padding: clamp(12px, 1.6vw, 16px) clamp(20px, 2.8vw, 28px);
      border-radius: var(--radius-md);
      font-family: 'Outfit', sans-serif;
      font-weight: 700;
      font-size: var(--text-base);
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      display: inline-flex;
      align-items: center;
      gap: clamp(8px, 1.2vw, 12px);
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
      min-width: min-content;
      white-space: nowrap;
    }

    .btn::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s ease;
    }

    .btn:hover::before {
      transform: translateX(100%);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), #2563eb);
      color: white;
      box-shadow: 0 8px 25px rgba(0,0,0,0.6);
    }

    .btn-primary:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.7), var(--shadow-glow);
    }

    .btn-primary:active {
      transform: scale(0.97);
    }

    .btn-accent {
      background: linear-gradient(135deg, var(--accent), #0284c7);
      color: white;
      box-shadow: 0 8px 25px rgba(0,0,0,0.6);
    }

    .btn-accent:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.7), var(--shadow-accent);
    }

    .btn-ghost {
      background: transparent;
      border: clamp(1px, 0.2vw, 2px) solid rgba(255,255,255,0.2);
      color: var(--text-muted);
    }

    .btn-ghost:hover {
      border-color: var(--text-main);
      color: var(--text-main);
      background: rgba(255,255,255,0.05);
      transform: translateY(-3px);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success), #059669);
      color: white;
      box-shadow: 0 8px 25px rgba(0,0,0,0.6);
    }

    .btn-success:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.7), 0 0 25px rgba(16, 185, 129, 0.4);
    }

    .difficulty-selector {
      padding: clamp(12px, 1.4vw, 14px) clamp(16px, 2vw, 20px);
      border-radius: var(--radius-md);
      border: clamp(1px, 0.2vw, 2px) solid rgba(255,255,255,0.2);
      font-family: 'DM Sans', sans-serif;
      color: var(--text-main);
      background: rgba(10, 10, 10, 0.7);
      cursor: pointer;
      outline: none;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: var(--text-base);
      min-width: 140px;
    }

    .difficulty-selector:hover {
      border-color: var(--highlight);
      box-shadow: 0 0 15px rgba(96, 165, 250, 0.2);
    }

    .difficulty-selector:focus {
      border-color: var(--primary);
      box-shadow: 0 0 20px var(--primary-glow);
    }

    /* ========== CHALLENGE BOX ========== */
    .challenge-box {
      background: linear-gradient(145deg, rgba(10, 10, 10, 0.5), rgba(20, 20, 20, 0.8));
      border-radius: var(--radius-lg);
      padding: clamp(20px, 3vw, 30px);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.1);
      margin-bottom: clamp(20px, 3vw, 30px);
    }

    .challenge-box::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: clamp(4px, 0.6vw, 6px);
      background: linear-gradient(to bottom, var(--primary), var(--accent));
      box-shadow: 0 0 15px var(--primary-glow);
    }

    .challenge-header {
      margin-bottom: clamp(15px, 2vw, 20px);
    }

    .challenge-title {
      display: flex;
      align-items: center;
      gap: clamp(12px, 1.5vw, 15px);
      margin-bottom: clamp(8px, 1vw, 10px);
    }

    .challenge-icon {
      width: clamp(40px, 5vw, 50px);
      height: clamp(40px, 5vw, 50px);
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(14, 165, 233, 0.2));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--text-lg);
      color: var(--highlight);
      flex-shrink: 0;
    }

    .input-group {
      display: flex;
      gap: clamp(10px, 1.5vw, 15px);
      margin-top: clamp(20px, 2.5vw, 25px);
    }

    .input-field {
      flex: 1;
      min-width: 0; /* Prevents overflow */
      padding: clamp(14px, 1.8vw, 18px) clamp(18px, 2.2vw, 22px);
      border-radius: var(--radius-md);
      border: clamp(1px, 0.2vw, 2px) solid rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.4);
      color: var(--text-bright);
      font-size: var(--text-base);
      font-family: 'Outfit', sans-serif;
      outline: none;
      transition: all 0.3s ease;
    }

    .input-field:focus {
      border-color: var(--primary);
      background: rgba(0,0,0,0.6);
      box-shadow: 0 0 20px var(--primary-glow);
    }

    .input-field::placeholder {
      color: rgba(255,255,255,0.3);
    }

    /* ========== FEEDBACK ========== */
    .feedback-container {
      margin-top: clamp(15px, 2vw, 20px);
      min-height: clamp(40px, 6vh, 60px);
      display: flex;
      align-items: center;
      transition: all 0.4s ease;
    }

    .feedback {
      padding: clamp(12px, 1.5vw, 15px) clamp(16px, 2vw, 20px);
      border-radius: var(--radius-md);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: clamp(8px, 1.2vw, 12px);
      width: 100%;
      animation: slideIn 0.4s ease-out;
      font-size: var(--text-base);
    }

    .feedback.correct {
      background: rgba(16, 185, 129, 0.15);
      border-left: clamp(3px, 0.4vw, 4px) solid var(--success);
      color: var(--success);
    }

    .feedback.incorrect {
      background: rgba(239, 68, 68, 0.15);
      border-left: clamp(3px, 0.4vw, 4px) solid var(--danger);
      color: var(--danger);
    }

    .feedback.info {
      background: rgba(96, 165, 250, 0.15);
      border-left: clamp(3px, 0.4vw, 4px) solid var(--highlight);
      color: var(--highlight);
    }

    /* ========== ACHIEVEMENTS ========== */
    .achievements-bar {
      display: flex;
      gap: clamp(10px, 1.5vw, 15px);
      margin-top: clamp(20px, 2.5vw, 25px);
      flex-wrap: wrap;
      justify-content: center;
    }

    .achievement {
      width: clamp(50px, 7vw, 70px);
      height: clamp(50px, 7vw, 70px);
      background: rgba(0, 0, 0, 0.4);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(1.2rem, 1.8vw, 1.8rem);
      border: clamp(1px, 0.2vw, 2px) solid rgba(255,255,255,0.1);
      transition: all 0.3s ease;
      position: relative;
      cursor: pointer;
      flex-shrink: 0;
    }

    .achievement:hover {
      transform: scale(1.1);
      border-color: var(--accent);
      box-shadow: 0 0 20px rgba(14, 165, 233, 0.3);
    }

    .achievement.locked {
      filter: grayscale(1);
      opacity: 0.5;
    }

    .achievement-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(10, 10, 10, 0.95);
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-sm);
      font-size: var(--text-sm);
      white-space: nowrap;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: var(--shadow-md);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      z-index: 100;
      margin-bottom: var(--space-sm);
    }

    .achievement:hover .achievement-tooltip {
      opacity: 1;
      visibility: visible;
    }

    /* ========== CONTENT SECTIONS ========== */
    .content-section {
      animation: fadeIn 0.5s ease-out;
    }

    .doc-content {
      max-height: 65vh;
      overflow-y: auto;
      padding-right: var(--space-md);
      line-height: 1.7;
    }

    .doc-content h2 {
      color: var(--highlight);
      margin-bottom: clamp(15px, 2vw, 20px);
      padding-bottom: var(--space-sm);
      border-bottom: clamp(1px, 0.2vw, 2px) solid rgba(96, 165, 250, 0.3);
    }

    .doc-content h3 {
      color: var(--text-bright);
      margin-top: clamp(20px, 3vw, 30px);
      margin-bottom: clamp(12px, 1.5vw, 15px);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .doc-content h3 i {
      color: var(--accent);
    }

    .doc-content ul, .doc-content ol {
      margin-left: clamp(20px, 2.5vw, 25px);
      margin-bottom: clamp(20px, 2.5vw, 25px);
    }

    .doc-content li {
      margin-bottom: var(--space-sm);
      color: #d1d5db;
    }

    .doc-content code {
      background: rgba(0, 0, 0, 0.4);
      padding: clamp(2px, 0.3vw, 4px) clamp(6px, 1vw, 10px);
      border-radius: var(--radius-xs);
      color: var(--accent);
      font-family: monospace;
      font-size: var(--text-sm);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .example-box {
      background: rgba(255, 255, 255, 0.05);
      padding: clamp(15px, 2vw, 20px);
      border-radius: var(--radius-md);
      margin: clamp(20px, 2.5vw, 25px) 0;
      border: 1px solid rgba(255,255,255,0.1);
      border-left: clamp(3px, 0.4vw, 4px) solid var(--primary);
    }

    /* ========== ACHIEVEMENTS GRID ========== */
    .achievements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(min(100%, 350px), 1fr));
      gap: clamp(15px, 2vw, 20px);
      margin-top: clamp(20px, 3vw, 30px);
    }

    .achievement-card {
      background: rgba(20, 20, 20, 0.6);
      border-radius: var(--radius-md);
      padding: clamp(15px, 2vw, 20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: clamp(15px, 2vw, 20px);
    }

    .achievement-card:hover {
      transform: translateY(-5px);
      background: rgba(30, 30, 30, 0.7);
      border-color: rgba(96, 165, 250, 0.3);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }

    .achievement-card.locked {
      opacity: 0.7;
      filter: grayscale(0.5);
    }

    .achievement-icon {
      width: clamp(50px, 7vw, 70px);
      height: clamp(50px, 7vw, 70px);
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(14, 165, 233, 0.2));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(1.5rem, 2vw, 2rem);
      flex-shrink: 0;
    }

    .achievement-card.locked .achievement-icon {
      background: linear-gradient(135deg, rgba(100, 100, 100, 0.2), rgba(70, 70, 70, 0.2));
    }

    .achievement-info {
      flex: 1;
      min-width: 0; /* Prevents flex overflow */
    }

    .achievement-info h4 {
      margin-bottom: var(--space-xs);
      color: var(--text-bright);
      font-size: var(--text-base);
    }

    .achievement-info p {
      font-size: var(--text-sm);
      color: var(--text-muted);
      margin-bottom: var(--space-sm);
    }

    .achievement-status {
      font-size: var(--text-xs);
      font-weight: 700;
      padding: clamp(3px, 0.4vw, 4px) clamp(10px, 1.2vw, 12px);
      border-radius: 20px;
      display: inline-block;
    }

    .achievement-status.unlocked {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .achievement-status.locked {
      background: rgba(100, 100, 100, 0.2);
      color: var(--text-muted);
    }

    /* ========== LEADERBOARD ========== */
    .leaderboard-container {
      margin-top: clamp(15px, 2vw, 20px);
    }

    .leaderboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: clamp(20px, 2.5vw, 25px);
      flex-wrap: wrap;
      gap: var(--space-md);
    }

    .leaderboard-list {
      list-style: none;
      padding: 0;
      margin: 0;
      border-radius: var(--radius-md);
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .leaderboard-list li {
      display: flex;
      justify-content: space-between;
      padding: clamp(15px, 2vw, 20px);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      font-weight: 600;
      color: var(--text-main);
      background: rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }

    .leaderboard-list li:hover {
      background: rgba(255, 255, 255, 0.05);
      transform: translateX(5px);
    }

    .leaderboard-list li:first-child {
      background: linear-gradient(90deg, rgba(245, 158, 11, 0.2), transparent);
      color: #fbbf24;
      font-weight: 800;
      font-size: var(--text-base);
    }

    .leaderboard-list li:nth-child(2) {
      background: linear-gradient(90deg, rgba(156, 163, 175, 0.2), transparent);
      color: #d1d5db;
      font-weight: 700;
    }

    .leaderboard-list li:nth-child(3) {
      background: linear-gradient(90deg, rgba(180, 83, 9, 0.2), transparent);
      color: #f97316;
      font-weight: 700;
    }

    .player-rank {
      display: flex;
      align-items: center;
      gap: clamp(12px, 1.5vw, 15px);
    }

    .rank-icon {
      width: clamp(30px, 4vw, 40px);
      height: clamp(30px, 4vw, 40px);
      background: rgba(0, 0, 0, 0.5);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      flex-shrink: 0;
      font-size: var(--text-sm);
    }

    .player-name-input {
      margin-top: clamp(20px, 3vw, 30px);
      padding-top: clamp(20px, 3vw, 30px);
      border-top: 1px dashed rgba(255,255,255,0.15);
    }

    /* ========== PROGRESS BARS ========== */
    .progress-container {
      margin-top: var(--space-md);
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--space-xs);
      font-size: var(--text-sm);
      color: var(--text-muted);
    }

    .progress-bar {
      height: clamp(8px, 1vh, 10px);
      background: rgba(0, 0, 0, 0.3);
      border-radius: 5px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 5px;
      transition: width 0.5s ease;
      position: relative;
      overflow: hidden;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      width: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: shimmer 2s infinite;
    }

    /* ========== ANIMATIONS ========== */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes float-1 {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      50% { transform: translate(30px, 30px) rotate(180deg); }
    }

    @keyframes float-2 {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      50% { transform: translate(-40px, -20px) rotate(-180deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.1); }
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    @keyframes glow {
      0%, 100% { box-shadow: 0 0 10px var(--primary-glow); }
      50% { box-shadow: 0 0 25px var(--primary-glow); }
    }

    /* ========== UTILITY CLASSES ========== */
    .shake {
      animation: shake 0.5s ease-in-out;
      border-color: var(--danger) !important;
    }

    .pop {
      animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .glow {
      animation: glow 1.5s infinite alternate;
    }

    .badge {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      padding: clamp(4px, 0.6vw, 6px) clamp(10px, 1.4vw, 14px);
      border-radius: 20px;
      font-size: var(--text-xs);
      font-weight: 800;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
    }

    /* ========== SCROLLBAR ========== */
    ::-webkit-scrollbar {
      width: clamp(8px, 1vw, 10px);
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, var(--primary), var(--accent));
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(to bottom, var(--accent), var(--highlight));
    }

    /* ========== RESPONSIVE BREAKPOINTS ========== */
    
    /* Tablet (768px - 1024px) */
    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: minmax(200px, 250px) 1fr;
        gap: clamp(15px, 2.5vw, 25px);
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .slots-container {
        gap: clamp(10px, 1.5vw, 15px);
      }
      
      .slot {
        width: clamp(90px, 12vw, 120px);
        height: clamp(130px, 16vw, 160px);
      }
      
      .achievements-grid {
        grid-template-columns: repeat(auto-fill, minmax(min(100%, 300px), 1fr));
      }
    }

    /* Large Mobile / Small Tablet (600px - 768px) */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        text-align: center;
        gap: clamp(15px, 2vw, 20px);
      }
      
      .logo-box {
        transform: rotate(0);
      }
      
      .layout {
        grid-template-columns: 1fr;
        gap: clamp(15px, 2.5vw, 25px);
      }
      
      nav.card {
        position: relative;
        top: 0;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
        gap: clamp(10px, 1.5vw, 15px);
      }
      
      .slots-container {
        flex-direction: column;
        align-items: center;
        gap: clamp(15px, 2vw, 20px);
      }
      
      .slot {
        width: min(90%, 250px);
        height: clamp(100px, 15vh, 140px);
        flex-direction: row;
        justify-content: flex-start;
        padding: 0 clamp(20px, 3vw, 25px);
      }
      
      .slot-icon {
        margin-bottom: 0;
        margin-right: clamp(15px, 2vw, 20px);
        width: clamp(50px, 7vw, 70px);
        height: clamp(50px, 7vw, 70px);
      }
      
      .controls-bar {
        flex-direction: column;
        align-items: stretch;
        gap: clamp(8px, 1.2vw, 12px);
      }
      
      .btn {
        justify-content: center;
        width: 100%;
      }
      
      .difficulty-selector {
        width: 100%;
        min-width: unset;
      }
      
      .input-group {
        flex-direction: column;
      }
      
      .menu {
        flex-direction: row;
        overflow-x: auto;
        padding: var(--space-sm);
        gap: var(--space-xs);
      }
      
      .menu-item {
        white-space: nowrap;
        padding: clamp(10px, 1.2vw, 12px) clamp(12px, 1.5vw, 15px);
        margin-bottom: 0;
      }
      
      .achievements-grid {
        grid-template-columns: 1fr;
      }
      
      .achievement-card {
        flex-direction: column;
        text-align: center;
        padding: clamp(20px, 2.5vw, 25px);
        gap: var(--space-md);
      }
      
      .achievement-info {
        text-align: center;
      }
      
      .leaderboard-header {
        flex-direction: column;
        align-items: stretch;
      }
      
      .leaderboard-header h2 {
        text-align: center;
      }
    }

    /* Mobile (up to 600px) */
    @media (max-width: 600px) {
      .container {
        padding: clamp(15px, 2vw, 20px) clamp(10px, 1.5vw, 15px);
      }
      
      .card {
        padding: clamp(15px, 2vw, 20px);
      }
      
      h1 {
        font-size: var(--text-3xl);
      }
      
      h2 {
        font-size: var(--text-2xl);
      }
      
      h3 {
        font-size: var(--text-xl);
      }
      
      .preview-stage::before {
        font-size: clamp(1rem, 1.5vw, 1.5rem);
        top: clamp(10px, 1.5vw, 15px);
      }
      
      .slot {
        width: min(85%, 220px);
      }
      
      .stat-value {
        font-size: clamp(1.5rem, 2vw, 1.8rem);
      }
      
      .btn {
        padding: clamp(10px, 1.4vw, 14px) clamp(16px, 2.2vw, 20px);
        font-size: var(--text-sm);
      }
      
      .menu {
        gap: var(--space-xs);
      }
      
      .menu-item {
        font-size: var(--text-sm);
        padding: var(--space-sm) var(--space-md);
      }
      
      .difficulty-selector {
        font-size: var(--text-sm);
        padding: var(--space-sm) var(--space-md);
      }
      
      .input-field {
        font-size: var(--text-sm);
        padding: var(--space-md) var(--space-lg);
      }
      
      .feedback {
        font-size: var(--text-sm);
        padding: var(--space-sm) var(--space-md);
      }
      
      /* Touch-friendly tap targets */
      .btn,
      .menu-item,
      .achievement,
      .slot {
        min-height: 44px; /* Apple's minimum touch target */
      }
      
      .input-field {
        min-height: 44px;
      }
      
      .difficulty-selector {
        min-height: 44px;
      }
    }

    /* Small Mobile (up to 400px) */
    @media (max-width: 400px) {
      .header-content h1 {
        font-size: var(--text-2xl);
      }
      
      .tagline {
        font-size: var(--text-sm);
      }
      
      .slot {
        width: min(90%, 180px);
        height: clamp(90px, 12vh, 120px);
      }
      
      .slot-icon {
        width: clamp(40px, 6vw, 50px);
        height: clamp(40px, 6vw, 50px);
        font-size: clamp(1.2rem, 1.8vw, 1.8rem);
      }
      
      .slot-label {
        font-size: 0.7rem;
      }
      
      .stat-card {
        padding: var(--space-sm);
      }
      
      .achievement {
        width: clamp(40px, 6vw, 50px);
        height: clamp(40px, 6vw, 50px);
        font-size: clamp(1rem, 1.5vw, 1.5rem);
      }
    }

    /* Landscape Mode Optimization */
    @media (max-height: 600px) and (orientation: landscape) {
      .container {
        padding: clamp(10px, 1.5vw, 15px) clamp(10px, 1.5vw, 15px);
      }
      
      .preview-stage {
        min-height: clamp(150px, 20vh, 200px);
      }
      
      .slot {
        height: clamp(120px, 15vh, 150px);
      }
      
      .doc-content {
        max-height: 50vh;
      }
    }

    /* High DPI Screens */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      .logo-box img {
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      }
    }

    /* Reduced Motion Preference */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      
      .logo-box:hover {
        transform: none;
      }
      
      .slot:hover {
        transform: none;
      }
      
      .btn:hover {
        transform: none;
      }
      
      .menu-item:hover {
        transform: none;
      }
    }

    /* Dark Mode Support (already dark) */
    @media (prefers-color-scheme: dark) {
      /* Already optimized for dark mode */
    }

    /* Print Styles */
    @media print {
      .bg-effects,
      .stars,
      .btn,
      .menu,
      .slot:hover,
      .card:hover {
        display: none !important;
      }
      
      body {
        background: white !important;
        color: black !important;
      }
      
      .card {
        background: white !important;
        border: 1px solid #ccc !important;
        box-shadow: none !important;
      }
    }
  </style>
</head>
<body>
  <!-- Background Effects -->
  <div class="bg-effects">
    <div class="bg-glow-1"></div>
    <div class="bg-glow-2"></div>
    <div class="bg-glow-3"></div>
  </div>
  
  <div class="stars" id="stars-container"></div>

  <div class="container">
    <header>
      <div class="logo-container">
        <div class="logo-box">
          <img src="Logo.png" alt="Outfit Combo Quest Logo">
        </div>
      </div>
      
      <div class="header-content">
        <h1>Outfit Combo Quest</h1>
        <p class="tagline">
          <i class="fas fa-graduation-cap"></i>
          Master Combinatorics Through Fashion
        </p>
        <div class="progress-container">
          <div class="progress-label">
            <span>Learning Progress</span>
            <span id="progress-percent">0%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
          </div>
        </div>
      </div>
    </header>

    <div class="layout">
      <nav class="card">
        <div class="nav-header">
          <h3><i class="fas fa-compass"></i> Navigation</h3>
        </div>
        <div class="menu">
          <button class="menu-item active" data-view="game">
            <i class="fas fa-gamepad"></i> Play Game
            <span class="badge" id="game-badge">New</span>
          </button>
          <button class="menu-item" data-view="tutorial">
            <i class="fas fa-graduation-cap"></i> Tutorial
          </button>
          <button class="menu-item" data-view="docs">
            <i class="fas fa-book"></i> Documentation
          </button>
          <button class="menu-item" data-view="achievements">
            <i class="fas fa-trophy"></i> Achievements
            <span class="badge" id="achievement-count">0</span>
          </button>
          <button class="menu-item" data-view="leaderboard">
            <i class="fas fa-crown"></i> Leaderboard
          </button>
          <button class="menu-item" data-view="about">
            <i class="fas fa-info-circle"></i> About
          </button>
        </div>
      </nav>

      <main class="card" id="panel">
        <!-- Game View -->
        <section id="view-game" class="content-section">
          <div class="game-header">
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-label"><i class="fas fa-star"></i> Score</div>
                <div class="stat-value" id="score">0</div>
                <div class="stat-sub">Total Points</div>
              </div>
              <div class="stat-card">
                <div class="stat-label"><i class="fas fa-fire"></i> Streak</div>
                <div class="stat-value" id="streak">0</div>
                <div class="stat-sub">Consecutive Correct</div>
              </div>
              <div class="stat-card">
                <div class="stat-label"><i class="fas fa-heart"></i> Lives</div>
                <div class="stat-value" id="lives">3</div>
                <div class="stat-sub">Remaining Attempts</div>
              </div>
            </div>
          </div>

          <div class="preview-stage">
            <div class="slots-container">
              <div class="slot" id="slot-shirt">
                <div class="slot-icon" id="shirt-item">?</div>
                <div class="slot-label">Tops</div>
                <div class="slot-category" id="shirt-category">Waiting...</div>
              </div>
              <div class="slot" id="slot-pants">
                <div class="slot-icon" id="pants-item">?</div>
                <div class="slot-label">Bottoms</div>
                <div class="slot-category" id="pants-category">Waiting...</div>
              </div>
              <div class="slot" id="slot-shoes">
                <div class="slot-icon" id="shoes-item">?</div>
                <div class="slot-label">Shoes</div>
                <div class="slot-category" id="shoes-category">Waiting...</div>
              </div>
            </div>
          </div>

          <div class="controls-bar">
            <button class="btn btn-primary" id="draw-btn">
              <i class="fas fa-bolt"></i>
              <span>Generate Scenario</span>
            </button>
            <button class="btn btn-ghost" id="hint-btn">
              <i class="fas fa-lightbulb"></i>
              Hint
            </button>
            <select class="difficulty-selector" id="difficulty">
              <option value="beginner">Beginner</option>
              <option value="intermediate">Intermediate</option>
              <option value="advanced">Advanced</option>
              <option value="expert">Expert</option>
            </select>
            <button class="btn btn-success" id="powerup-btn" title="Use Power-up">
              <i class="fas fa-magic"></i>
              Power-up (3)
            </button>
          </div>

          <div class="challenge-box">
            <div class="challenge-header">
              <div class="challenge-title">
                <div class="challenge-icon">
                  <i class="fas fa-tshirt"></i>
                </div>
                <div>
                  <h3 id="challenge-title">Welcome to the Studio</h3>
                  <p id="difficulty-display" class="badge">Difficulty: Beginner</p>
                </div>
              </div>
              <p id="challenge-desc" style="color:var(--text-muted);">Select a difficulty and press <strong>Generate Scenario</strong> to begin the challenge.</p>
            </div>
            
            <div class="input-group">
              <input id="answer-input" class="input-field" type="text" placeholder="Enter your calculation (e.g. 24 or 4*3*2)" autocomplete="off">
              <button class="btn btn-accent" id="submit-btn">
                <i class="fas fa-paper-plane"></i>
                Submit Answer
              </button>
            </div>
            
            <div class="feedback-container">
              <div id="feedback" class="feedback"></div>
            </div>
            
            <div class="progress-container" style="margin-top: 20px;">
              <div class="progress-label">
                <span>Time Remaining</span>
                <span id="time-label">60s</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="time-progress" style="width: 100%"></div>
              </div>
            </div>
          </div>
          
          <div class="achievements-bar" id="achievements-display">
            <!-- Achievements will be dynamically inserted here -->
          </div>
        </section>

        <!-- Tutorial View -->
        <section id="view-tutorial" class="content-section" style="display:none">
          <div class="doc-content">
            <h2><i class="fas fa-graduation-cap"></i> How to Play</h2>
            <p>Welcome to Outfit Combo Quest! Your goal is to help Luna prepare for events by calculating the number of possible outfit combinations based on her inventory.</p>
            
            <h3><i class="fas fa-walking"></i> Step-by-Step Guide</h3>
            <ol>
              <li><strong>Select Difficulty:</strong> Choose from Beginner, Intermediate, Advanced, or Expert levels. Higher difficulties introduce complex restrictions.</li>
              <li><strong>Generate Scenario:</strong> Click "Generate Scenario" to receive a unique problem. The inventory slots will animate and display item counts.</li>
              <li><strong>Understand the Problem:</strong> Read the scenario description carefully. Pay attention to restrictions like "pastel only" or "wrinkle-free".</li>
              <li><strong>Apply Combinatorics:</strong> 
                <br><em>Beginner:</em> Simply multiply the three numbers shown.
                <br><em>Intermediate:</em> Filter items by the described condition before multiplying.
                <br><em>Advanced:</em> Use subtraction (total - restricted) before multiplication.
                <br><em>Expert:</em> May involve multiple conditions or partial restrictions.
              </li>
              <li><strong>Submit Answer:</strong> Type the total number. You can use math expressions like <code>5*3*2</code> or simply <code>30</code>.</li>
              <li><strong>Earn Points:</strong> Correct answers earn points based on difficulty and speed. Streaks multiply your score!</li>
            </ol>
            
            <div class="example-box">
              <h4><i class="fas fa-lightbulb"></i> Example Problem</h4>
              <p><strong>Scenario:</strong> 7 tops (4 wrinkle), 5 bottoms (1 wrinkles), 4 shoes.<br>
              <strong>Question:</strong> How many wrinkle-free outfits?<br>
              <strong>Solution:</strong> $(7-4) \times (5-1) \times 4 = 3 \times 4 \times 4 = 48$.</p>
            </div>
            
            <h3><i class="fas fa-trophy"></i> Tips for Success</h3>
            <ul>
              <li>Use the <strong>Hint</strong> button if you're stuck</li>
              <li>Maintain your streak for bonus points</li>
              <li>Watch the timer - faster answers earn more points</li>
              <li>Unlock achievements for special rewards</li>
            </ul>
          </div>
        </section>

        <!-- Documentation View -->
        <section id="view-docs" class="content-section" style="display:none">
          <div class="doc-content">
            <h2><i class="fas fa-book"></i> Documentation</h2>
            
            <h3><i class="fas fa-gamepad"></i> Game Overview</h3>
            <p><strong>Goal:</strong> Build valid outfits (top + bottom + shoes) that satisfy scenario conditions. Players compute the sample space size using combinatorial principles.</p>
            <p>The game reinforces mathematical reasoning through practical fashion scenarios, making abstract concepts tangible and engaging.</p>
            
            <h3><i class="fas fa-calculator"></i> Mathematical Concepts</h3>
            <ul>
              <li><strong>Fundamental Counting Principle (FCP):</strong> If task A has <em>m</em> ways and task B has <em>n</em> ways, doing both has <em>m Ã— n</em> ways.</li>
              <li><strong>Filtering/Restrictions:</strong> In Intermediate/Advanced levels, the sample space is reduced ($N_{valid} \subset N_{total}$) before applying FCP.</li>
              <li><strong>Complement Rule:</strong> In Advanced levels, sometimes it is easier to calculate $Total - Invalid$.</li>
              <li><strong>Multiplication Principle:</strong> The core of outfit combination calculation.</li>
            </ul>

            <h3><i class="fas fa-chart-line"></i> Scoring System</h3>
            <p>Points are awarded based on:</p>
            <ul>
              <li><strong>Base Points:</strong> Beginner: 100, Intermediate: 200, Advanced: 350, Expert: 500</li>
              <li><strong>Time Bonus:</strong> Up to 100 points based on remaining time</li>
              <li><strong>Streak Multiplier:</strong> Each consecutive correct answer adds a 20% bonus</li>
              <li><strong>Difficulty Bonus:</strong> Extra points for harder levels</li>
            </ul>
            
            <div class="example-box">
              <h4><i class="fas fa-code"></i> Technical Implementation</h4>
              <p>The game is built with vanilla JavaScript, HTML5, and CSS3. No external frameworks are required. All animations use CSS keyframes and the Web Animations API for optimal performance.</p>
              <p>Data persistence uses localStorage for leaderboards and achievements. The game is fully responsive and works on mobile, tablet, and desktop devices.</p>
            </div>
            
            <h3><i class="fas fa-users"></i> Credits</h3>
            <p>Designed for Discrete Mathematics education. Developed by IT-2N Group 2.</p>
            <p><strong>Team Members:</strong> SERNA, Ralph Jeric M. | DE GUZMAN, Wildan Mark S. | MERCADO, Rochelle</p>
            <p><strong>Version:</strong> Enhanced Edition 2.0</p>
          </div>
        </section>

        <!-- Achievements View -->
        <section id="view-achievements" class="content-section" style="display:none">
          <div class="doc-content">
            <h2><i class="fas fa-trophy"></i> Achievements</h2>
            <p>Complete challenges to unlock these achievements. Each achievement provides special bonuses or visual enhancements.</p>
            
            <div id="achievements-list" class="achievements-grid">
              <!-- Achievements will be dynamically inserted here -->
            </div>
          </div>
        </section>

        <!-- Leaderboard View -->
        <section id="view-leaderboard" class="content-section" style="display:none">
          <div class="leaderboard-header">
            <h2><i class="fas fa-crown"></i> Top Stylists</h2>
            <button class="btn btn-ghost" id="reset-leaderboard">
              <i class="fas fa-redo"></i> Reset Local Scores
            </button>
          </div>
          
          <p style="color:var(--text-muted); margin-bottom:25px">High scores are stored locally on this device.</p>
          
          <div class="leaderboard-container">
            <ul id="lb-list" class="leaderboard-list">
              <!-- Leaderboard entries will be dynamically inserted here -->
            </ul>
          </div>
          
          <div class="player-name-input">
            <h3><i class="fas fa-user"></i> Player Profile</h3>
            <p style="margin-bottom: 15px; color: var(--text-muted);">Customize your player name for the leaderboard.</p>
            <input id="player-name" class="input-field" placeholder="Enter your stylist name" value="Guest Stylist">
            <button class="btn btn-primary" id="save-player-name" style="margin-top: 15px;">
              <i class="fas fa-save"></i> Save Name
            </button>
          </div>
        </section>

        <!-- About View -->
        <section id="view-about" class="content-section" style="display:none">
          <div class="doc-content">
            <h2><i class="fas fa-info-circle"></i> About Outfit Combo Quest</h2>
            
            <p><strong>Outfit Combo Quest (Enhanced Edition)</strong> is an interactive educational tool designed to visualize and test <strong>Combinatorics</strong> concepts through engaging fashion scenarios.</p>
            
            <h3><i class="fas fa-bullseye"></i> Educational Goals</h3>
            <ul>
              <li>Make abstract mathematical concepts tangible and memorable</li>
              <li>Develop problem-solving and logical reasoning skills</li>
              <li>Bridge the gap between theoretical math and real-world applications</li>
              <li>Provide immediate feedback to reinforce learning</li>
            </ul>
            
            <h3><i class="fas fa-code-branch"></i> Development</h3>
            <p>This enhanced version builds upon the original prototype with:</p>
            <ul>
              <li>Improved visual design with glass morphism effects</li>
              <li>Expanded gameplay mechanics and progression systems</li>
              <li>Advanced animations and visual feedback</li>
              <li>Achievements and power-up systems</li>
              <li>Responsive design for all devices</li>
            </ul>
            
            <div class="example-box">
              <h4><i class="fas fa-heart"></i> Acknowledgments</h4>
              <p>Special thanks to our Discrete Mathematics professor for inspiring this project and to all testers who provided valuable feedback during development.</p>
              <p>This project is dedicated to students struggling with combinatorics - may this game make the subject click for you!</p>
            </div>
            
            <h3><i class="fas fa-shield-alt"></i> Privacy & Data</h3>
            <p>All game data is stored locally on your device. No personal information is collected or transmitted. Leaderboard data remains on your device only.</p>
            
            <p style="margin-top: 30px; text-align: center; color: var(--accent); font-weight: 600;">
              <i class="fas fa-magic"></i> Happy calculating, future mathematicians!
            </p>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- JavaScript remains the same as before - no changes needed -->
  <script>
    // Enhanced Game State
    const state = {
      difficulty: 'beginner',
      score: 0,
      streak: 0,
      lives: 3,
      roundData: null,
      timer: null,
      timeLeft: 60,
      isAnimating: false,
      achievements: [],
      powerups: 3,
      playerName: 'Guest Stylist',
      progress: 0,
      totalProblems: 0,
      correctProblems: 0
    };

    // Initialize stars background
    function initStars() {
      const container = document.getElementById('stars-container');
      if (!container) return;
      
      for (let i = 0; i < 150; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        star.style.width = `${Math.random() * 3 + 1}px`;
        star.style.height = star.style.width;
        star.style.opacity = Math.random() * 0.7 + 0.3;
        star.style.setProperty('--duration', `${Math.random() * 5 + 3}s`);
        container.appendChild(star);
      }
    }

    // Utility Functions
    function randInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function safeEval(expr) {
      try {
        // Remove any non-math characters for security
        const cleanExpr = expr.replace(/[^0-9+\-*/().]/g, '');
        return Function('"use strict"; return (' + cleanExpr + ')')();
      } catch (e) {
        return NaN;
      }
    }

    // DOM Elements - All buttons and inputs
    const views = {
      game: document.getElementById('view-game'),
      tutorial: document.getElementById('view-tutorial'),
      docs: document.getElementById('view-docs'),
      achievements: document.getElementById('view-achievements'),
      leaderboard: document.getElementById('view-leaderboard'),
      about: document.getElementById('view-about')
    };

    const menuBtns = document.querySelectorAll('.menu-item');
    const drawBtn = document.getElementById('draw-btn');
    const hintBtn = document.getElementById('hint-btn');
    const submitBtn = document.getElementById('submit-btn');
    const powerupBtn = document.getElementById('powerup-btn');
    const challengeTitle = document.getElementById('challenge-title');
    const challengeDesc = document.getElementById('challenge-desc');
    const answerInput = document.getElementById('answer-input');
    const feedback = document.getElementById('feedback');
    const scoreEl = document.getElementById('score');
    const streakEl = document.getElementById('streak');
    const livesEl = document.getElementById('lives');
    const diffSelect = document.getElementById('difficulty');
    const diffDisplay = document.getElementById('difficulty-display');
    const lbList = document.getElementById('lb-list');
    const playerNameInput = document.getElementById('player-name');
    const savePlayerNameBtn = document.getElementById('save-player-name');
    const timeLabel = document.getElementById('time-label');
    const timeProgress = document.getElementById('time-progress');
    const resetLeaderboardBtn = document.getElementById('reset-leaderboard');
    const progressFill = document.getElementById('progress-fill');
    const progressPercent = document.getElementById('progress-percent');
    
    // Slot elements
    const slotItems = [
      document.getElementById('shirt-item'),
      document.getElementById('pants-item'),
      document.getElementById('shoes-item')
    ];
    
    const slotCategories = [
      document.getElementById('shirt-category'),
      document.getElementById('pants-category'),
      document.getElementById('shoes-category')
    ];

    // Category names for flavor text
    const categories = {
      tops: ['T-Shirts', 'Blouses', 'Sweaters', 'Jackets', 'Hoodies', 'Tank Tops', 'Polos', 'Button-ups'],
      bottoms: ['Jeans', 'Trousers', 'Shorts', 'Skirts', 'Leggings', 'Sweatpants', 'Chinos', 'Cargo Pants'],
      shoes: ['Sneakers', 'Boots', 'Sandals', 'Loafers', 'Heels', 'Flats', 'Oxfords', 'Slip-ons']
    };

    // Achievement definitions
    const achievementDefs = [
      { id: 'first_win', name: 'First Victory', desc: 'Complete your first challenge', icon: 'ðŸ¥‡', unlocked: false },
      { id: 'streak_5', name: 'Hot Streak', desc: 'Get 5 correct answers in a row', icon: 'ðŸ”¥', unlocked: false },
      { id: 'streak_10', name: 'Unstoppable', desc: 'Get 10 correct answers in a row', icon: 'âš¡', unlocked: false },
      { id: 'no_hints', name: 'Independent Thinker', desc: 'Complete 5 challenges without using hints', icon: 'ðŸ§ ', unlocked: false },
      { id: 'speed_demon', name: 'Speed Demon', desc: 'Answer 3 challenges with more than 20 seconds remaining', icon: 'â±ï¸', unlocked: false },
      { id: 'perfectionist', name: 'Perfectionist', desc: 'Get a perfect score on any difficulty', icon: 'ðŸ’¯', unlocked: false },
      { id: 'advanced_master', name: 'Advanced Master', desc: 'Complete 10 advanced challenges', icon: 'ðŸŽ“', unlocked: false },
      { id: 'combo_king', name: 'Combo King', desc: 'Calculate a combination of 100+ outfits', icon: 'ðŸ‘‘', unlocked: false },
      { id: 'comeback_kid', name: 'Comeback Kid', desc: 'Win a challenge with only 1 life remaining', icon: 'ðŸ’ª', unlocked: false },
      { id: 'math_wizard', name: 'Math Wizard', desc: 'Score over 5000 points in a single session', icon: 'ðŸ§™', unlocked: false }
    ];

    // Initialize achievements from localStorage
    function initAchievements() {
      const saved = localStorage.getItem('oc_achievements');
      if (saved) {
        const savedAchievements = JSON.parse(saved);
        achievementDefs.forEach(ach => {
          const savedAch = savedAchievements.find(a => a.id === ach.id);
          if (savedAch) ach.unlocked = savedAch.unlocked;
        });
      }
      updateAchievementCount();
    }

    // Save achievements to localStorage
    function saveAchievements() {
      localStorage.setItem('oc_achievements', JSON.stringify(achievementDefs));
      updateAchievementCount();
    }

    // Update achievement count badge
    function updateAchievementCount() {
      const count = achievementDefs.filter(a => a.unlocked).length;
      const badge = document.getElementById('achievement-count');
      if (badge) badge.textContent = count;
    }

    // Check and unlock achievements
    function checkAchievements() {
      let changed = false;
      
      // First win
      if (state.correctProblems >= 1 && !achievementDefs[0].unlocked) {
        achievementDefs[0].unlocked = true;
        changed = true;
        showNotification('Achievement Unlocked: First Victory!', 'success');
      }
      
      // Streak 5
      if (state.streak >= 5 && !achievementDefs[1].unlocked) {
        achievementDefs[1].unlocked = true;
        changed = true;
        showNotification('Achievement Unlocked: Hot Streak!', 'success');
      }
      
      // Streak 10
      if (state.streak >= 10 && !achievementDefs[2].unlocked) {
        achievementDefs[2].unlocked = true;
        changed = true;
        showNotification('Achievement Unlocked: Unstoppable!', 'success');
      }
      
      // Perfectionist (score over 1000 on any challenge)
      if (state.score > 1000 && !achievementDefs[5].unlocked) {
        achievementDefs[5].unlocked = true;
        changed = true;
        showNotification('Achievement Unlocked: Perfectionist!', 'success');
      }
      
      if (changed) {
        saveAchievements();
        renderAchievementDisplay();
      }
    }

    // FIXED: Render achievements with proper layout
    function renderAchievements() {
      const container = document.getElementById('achievements-list');
      if (!container) return;
      
      container.innerHTML = '';
      
      achievementDefs.forEach(ach => {
        const achEl = document.createElement('div');
        achEl.className = `achievement-card ${ach.unlocked ? '' : 'locked'}`;
        achEl.innerHTML = `
          <div class="achievement-icon">
            ${ach.icon}
          </div>
          <div class="achievement-info">
            <h4>${ach.name}</h4>
            <p>${ach.desc}</p>
            <span class="achievement-status ${ach.unlocked ? 'unlocked' : 'locked'}">
              ${ach.unlocked ? 'âœ“ UNLOCKED' : 'ðŸ”’ LOCKED'}
            </span>
          </div>
        `;
        container.appendChild(achEl);
      });
    }

    // Render achievement display in game view
    function renderAchievementDisplay() {
      const container = document.getElementById('achievements-display');
      if (!container) return;
      
      container.innerHTML = '';
      
      const unlocked = achievementDefs.filter(a => a.unlocked);
      unlocked.slice(0, 5).forEach(ach => {
        const achEl = document.createElement('div');
        achEl.className = 'achievement';
        achEl.innerHTML = `
          ${ach.icon}
          <div class="achievement-tooltip">${ach.name}</div>
        `;
        container.appendChild(achEl);
      });
    }

    // Show notification
    function showNotification(message, type = 'info') {
      // Remove existing notification
      const existing = document.querySelector('.notification');
      if (existing) existing.remove();
      
      const notification = document.createElement('div');
      notification.className = `notification feedback ${type}`;
      notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        ${message}
      `;
      notification.style.position = 'fixed';
      notification.style.top = '20px';
      notification.style.right = '20px';
      notification.style.zIndex = '1000';
      notification.style.maxWidth = '300px';
      notification.style.animation = 'slideIn 0.3s ease-out';
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100px)';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Update progress
    function updateProgress() {
      if (state.totalProblems > 0) {
        state.progress = Math.min(100, Math.round((state.correctProblems / state.totalProblems) * 100));
      }
      if (progressFill) progressFill.style.width = `${state.progress}%`;
      if (progressPercent) progressPercent.textContent = `${state.progress}%`;
    }

    // Switch View Logic - FIXED VERSION
    if (menuBtns) {
      menuBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          // Remove active class from all menu items
          menuBtns.forEach(b => b.classList.remove('active'));
          
          // Add active class to clicked button
          this.classList.add('active');
          
          // Hide all views
          Object.values(views).forEach(view => {
            if (view) view.style.display = 'none';
          });
          
          // Show the selected view
          const viewName = this.getAttribute('data-view');
          if (views[viewName]) {
            views[viewName].style.display = 'block';
            
            // Special handling for achievements view
            if (viewName === 'achievements') {
              renderAchievements();
            }
            
            // Special handling for leaderboard view
            if (viewName === 'leaderboard') {
              renderLeaderboard();
            }
          }
        });
      });
    }

    // Difficulty change handler
    if (diffSelect) {
      diffSelect.addEventListener('change', function() {
        state.difficulty = this.value;
        if (diffDisplay) {
          diffDisplay.textContent = `Difficulty: ${state.difficulty.charAt(0).toUpperCase() + state.difficulty.slice(1)}`;
          
          // Update difficulty badge color
          const colors = {
            beginner: 'var(--success)',
            intermediate: 'var(--primary)',
            advanced: 'var(--accent)',
            expert: 'var(--vibrant)'
          };
          diffDisplay.style.background = colors[state.difficulty] || colors.beginner;
        }
        
        resetRound();
      });
    }

    // Enhanced slot animation
    function animateSlots(finalValues, callback) {
      if (state.isAnimating) return;
      
      state.isAnimating = true;
      const duration = 1200;
      const startTime = Date.now();
      
      // Reset to random values
      slotItems.forEach(el => {
        if (el) el.textContent = randInt(1, 9);
      });
      
      slotCategories.forEach((el, i) => {
        if (el) {
          const category = i === 0 ? categories.tops : i === 1 ? categories.bottoms : categories.shoes;
          el.textContent = category[randInt(0, category.length - 1)];
        }
      });
      
      function animate() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        if (progress < 1) {
          // During animation, show random numbers
          if (elapsed % 100 < 50) {
            slotItems.forEach(el => {
              if (el) el.textContent = randInt(1, 9);
            });
          }
          requestAnimationFrame(animate);
        } else {
          // Animation complete
          slotItems.forEach((el, i) => {
            if (el) {
              el.textContent = finalValues[i];
              el.classList.add('pop');
              setTimeout(() => el.classList.remove('pop'), 300);
            }
          });
          
          // Set final categories
          slotCategories.forEach((el, i) => {
            if (el) {
              const category = i === 0 ? categories.tops : i === 1 ? categories.bottoms : categories.shoes;
              el.textContent = category[finalValues[i] % category.length];
            }
          });
          
          state.isAnimating = false;
          if (callback) callback();
        }
      }
      
      requestAnimationFrame(animate);
    }

    // Enhanced scenario generator
    function generateScenario() {
      const difficulties = {
        beginner: () => {
          const shirts = randInt(3, 8);
          const pants = randInt(2, 6);
          const shoes = randInt(2, 5);
          return {
            type: 'beginner',
            title: 'School Presentation',
            desc: `Luna needs a simple outfit for her school presentation. She has ${shirts} tops, ${pants} bottoms, and ${shoes} pairs of shoes. How many unique outfits can she create?`,
            slots: [shirts, pants, shoes],
            expected: shirts * pants * shoes,
            flavor: 'Simple combination with no restrictions.'
          };
        },
        
        intermediate: () => {
          const topsTotal = randInt(5, 10);
          const topsValid = randInt(2, topsTotal - 1);
          const bottomsTotal = randInt(4, 8);
          const bottomsValid = randInt(1, bottomsTotal - 1);
          const shoesTotal = randInt(3, 6);
          const shoesValid = randInt(1, shoesTotal - 1);
          
          const themes = ['Pastel', 'Formal', 'Casual', 'Sporty', 'Vintage'];
          const theme = themes[randInt(0, themes.length - 1)];
          
          return {
            type: 'intermediate',
            title: `${theme} Theme Party`,
            desc: `Theme: <strong>${theme} Only</strong>.<br>
                   Tops: ${topsTotal} total (${topsValid} are ${theme.toLowerCase()}).<br>
                   Bottoms: ${bottomsTotal} total (${bottomsValid} are ${theme.toLowerCase()}).<br>
                   Shoes: ${shoesTotal} total (${shoesValid} match the theme).<br>
                   How many ${theme.toLowerCase()} outfits can Luna create?`,
            slots: [topsTotal, bottomsTotal, shoesTotal],
            expected: topsValid * bottomsValid * shoesValid,
            flavor: `Filter items by "${theme}" theme before multiplying.`
          };
        },
        
        advanced: () => {
          const tTot = randInt(7, 12);
          const tBad = randInt(2, Math.floor(tTot / 2));
          const bTot = randInt(5, 9);
          const bBad = randInt(1, Math.floor(bTot / 2));
          const sTot = randInt(3, 7);
          
          const restrictions = ['wrinkle easily', 'are too casual', 'need ironing', 'are stained', 'don\'t fit properly'];
          const restriction = restrictions[randInt(0, restrictions.length - 1)];
          
          return {
            type: 'advanced',
            title: 'Travel Preparation',
            desc: `Luna is packing for a trip. Items that ${restriction} cannot be packed.<br>
                   Tops: ${tTot} total (${tBad} ${restriction}).<br>
                   Bottoms: ${bTot} total (${bBad} ${restriction}).<br>
                   Shoes: ${sTot} total (all are acceptable).<br>
                   How many valid outfits can she pack?`,
            slots: [tTot, bTot, sTot],
            expected: (tTot - tBad) * (bTot - bBad) * sTot,
            flavor: `Subtract invalid items before multiplying.`
          };
        },
        
        expert: () => {
          const tTot = randInt(8, 15);
          const tBad1 = randInt(1, Math.floor(tTot / 3));
          const tBad2 = randInt(1, Math.floor(tTot / 4));
          const bTot = randInt(6, 10);
          const bBad = randInt(1, Math.floor(bTot / 3));
          const sTot = randInt(4, 8);
          const sBad = randInt(1, Math.floor(sTot / 2));
          
          return {
            type: 'expert',
            title: 'Fashion Show Challenge',
            desc: `Luna is preparing for a fashion show with multiple restrictions:<br>
                   Tops: ${tTot} total (${tBad1} are too casual, ${tBad2} are the wrong color).<br>
                   Bottoms: ${bTot} total (${bBad} don't match the collection theme).<br>
                   Shoes: ${sTot} total (${sBad} are uncomfortable for walking).<br>
                   How many outfits meet ALL requirements?`,
            slots: [tTot, bTot, sTot],
            expected: (tTot - tBad1 - tBad2) * (bTot - bBad) * (sTot - sBad),
            flavor: 'Multiple restrictions requiring careful subtraction.'
          };
        }
      };
      
      return difficulties[state.difficulty] ? difficulties[state.difficulty]() : difficulties.beginner();
    }

    // Game flow functions
    function newRound() {
      if (state.isAnimating) return;
      
      // Reset UI
      if (feedback) {
        feedback.textContent = '';
        feedback.className = 'feedback';
      }
      
      if (answerInput) {
        answerInput.value = '';
        answerInput.classList.remove('shake');
      }
      
      state.roundData = generateScenario();
      state.totalProblems++;
      
      // Animate slots
      animateSlots(state.roundData.slots, () => {
        if (challengeTitle) challengeTitle.textContent = state.roundData.title;
        if (challengeDesc) challengeDesc.innerHTML = state.roundData.desc;
        if (answerInput) {
          answerInput.focus();
        }
        
        // Set timer based on difficulty
        const times = {
          beginner: 60,
          intermediate: 45,
          advanced: 35,
          expert: 25
        };
        
        startTimer(times[state.difficulty] || 60);
      });
    }

    function resetRound() {
      clearInterval(state.timer);
      state.score = 0;
      state.streak = 0;
      state.lives = 3;
      updateStats();
      
      if (feedback) {
        feedback.textContent = '';
        feedback.className = 'feedback';
      }
      
      if (challengeTitle) challengeTitle.textContent = 'Ready for a Challenge?';
      if (challengeDesc) challengeDesc.textContent = 'Select a difficulty and press "Generate Scenario" to begin.';
      
      slotItems.forEach(el => {
        if (el) el.textContent = '?';
      });
      
      slotCategories.forEach(el => {
        if (el) el.textContent = 'Waiting...';
      });
      
      if (timeLabel) timeLabel.textContent = '60s';
      if (timeProgress) {
        timeProgress.style.width = '100%';
        timeProgress.style.background = 'linear-gradient(90deg, var(--primary), var(--accent))';
      }
      
      updateProgress();
    }

    function updateStats() {
      if (scoreEl) scoreEl.textContent = state.score;
      if (streakEl) {
        streakEl.textContent = state.streak;
        
        // Update streak color based on value
        if (state.streak >= 10) {
          streakEl.style.color = '#fbbf24';
          streakEl.style.textShadow = '0 0 10px rgba(251, 191, 36, 0.5)';
        } else if (state.streak >= 5) {
          streakEl.style.color = 'var(--accent)';
          streakEl.style.textShadow = '0 0 10px rgba(14, 165, 233, 0.5)';
        } else if (state.streak >= 3) {
          streakEl.style.color = 'var(--highlight)';
          streakEl.style.textShadow = '0 0 10px rgba(96, 165, 250, 0.5)';
        } else {
          streakEl.style.color = '';
          streakEl.style.textShadow = '';
        }
      }
      
      if (livesEl) {
        const hearts = 'â™¥'.repeat(state.lives);
        livesEl.innerHTML = `<span style="color: var(--danger)">${hearts}</span>`;
      }
      
      // Animate score
      if (scoreEl) {
        scoreEl.classList.remove('pop');
        void scoreEl.offsetWidth; // Trigger reflow
        scoreEl.classList.add('pop');
      }
    }

    function startTimer(seconds) {
      clearInterval(state.timer);
      state.timeLeft = seconds;
      
      if (timeLabel) timeLabel.textContent = `${seconds}s`;
      if (timeProgress) {
        timeProgress.style.width = '100%';
        
        // Update progress bar color based on time
        const updateColor = () => {
          const percent = (state.timeLeft / seconds) * 100;
          if (percent > 50) {
            timeProgress.style.background = 'linear-gradient(90deg, var(--primary), var(--accent))';
          } else if (percent > 25) {
            timeProgress.style.background = 'linear-gradient(90deg, var(--warning), var(--accent))';
          } else {
            timeProgress.style.background = 'linear-gradient(90deg, var(--danger), var(--warning))';
          }
        };
        
        updateColor();
      }
      
      state.timer = setInterval(() => {
        state.timeLeft--;
        
        if (timeLabel) timeLabel.textContent = `${state.timeLeft}s`;
        if (timeProgress) {
          const percent = (state.timeLeft / seconds) * 100;
          timeProgress.style.width = `${percent}%`;
          
          // Update color
          if (percent > 50) {
            timeProgress.style.background = 'linear-gradient(90deg, var(--primary), var(--accent))';
          } else if (percent > 25) {
            timeProgress.style.background = 'linear-gradient(90deg, var(--warning), var(--accent))';
          } else {
            timeProgress.style.background = 'linear-gradient(90deg, var(--danger), var(--warning))';
          }
        }
        
        if (state.timeLeft <= 0) {
          clearInterval(state.timer);
          handleResult(false, true);
        }
      }, 1000);
    }

    // Event Listeners - Only attach if elements exist
    if (drawBtn) {
      drawBtn.addEventListener('click', newRound);
    }

    if (hintBtn) {
      hintBtn.addEventListener('click', () => {
        if (!state.roundData) return;
        let hint = '';
        switch (state.roundData.type) {
          case 'beginner':
            hint = 'Simply multiply the three numbers shown in the slots.';
            break;
          case 'intermediate':
            hint = 'Ignore the total counts. Multiply only the valid counts mentioned in the description.';
            break;
          case 'advanced':
            hint = 'Subtract the "bad" items from the totals first, then multiply the remaining counts.';
            break;
          case 'expert':
            hint = 'Subtract ALL restricted items from each category before multiplying.';
            break;
          default:
            hint = 'Read the problem carefully and apply the counting principle.';
        }
        
        if (feedback) {
          feedback.innerHTML = `<i class="fas fa-lightbulb"></i> ${hint}`;
          feedback.className = 'feedback info';
        }
      });
    }

    if (powerupBtn) {
      powerupBtn.addEventListener('click', () => {
        if (state.powerups <= 0) {
          showNotification('No power-ups remaining!', 'error');
          return;
        }
        
        if (!state.roundData) return;
        
        // Use a power-up
        state.powerups--;
        powerupBtn.innerHTML = `<i class="fas fa-magic"></i> Power-up (${state.powerups})`;
        
        // Add 15 seconds to the timer
        state.timeLeft += 15;
        const totalTime = state.difficulty === 'beginner' ? 60 : 
                         state.difficulty === 'intermediate' ? 45 :
                         state.difficulty === 'advanced' ? 35 : 25;
        const percent = (state.timeLeft / totalTime) * 100;
        
        if (timeProgress) {
          timeProgress.style.width = `${Math.min(percent, 100)}%`;
        }
        
        if (timeLabel) {
          timeLabel.textContent = `${state.timeLeft}s`;
        }
        
        showNotification('+15 seconds added!', 'success');
        
        // Disable button if no power-ups left
        if (state.powerups <= 0) {
          powerupBtn.disabled = true;
          powerupBtn.style.opacity = '0.5';
        }
      });
    }

    if (submitBtn) {
      submitBtn.addEventListener('click', () => {
        if (!state.roundData) return;
        const raw = answerInput ? answerInput.value.trim() : '';
        if (!raw) {
          if (feedback) {
            feedback.textContent = 'Please enter an answer.';
            feedback.className = 'feedback incorrect';
          }
          return;
        }
        
        const val = safeEval(raw);
        if (Number.isNaN(val) || typeof val !== 'number') {
          if (feedback) {
            feedback.textContent = 'Invalid number format. Use numbers and basic operators (+, -, *, /).';
            feedback.className = 'feedback incorrect';
          }
          return;
        }
        
        const correct = Math.floor(val) === Math.floor(state.roundData.expected);
        handleResult(correct);
      });
    }

    function handleResult(isCorrect, isTimeout = false) {
      clearInterval(state.timer);
      
      if (isCorrect) {
        // Calculate score
        const baseScores = {
          beginner: 100,
          intermediate: 200,
          advanced: 350,
          expert: 500
        };
        
        const base = baseScores[state.difficulty] || 100;
        const timeBonus = Math.floor(state.timeLeft * 2);
        const streakBonus = state.streak * 20;
        const total = base + timeBonus + streakBonus;
        
        state.score += total;
        state.streak++;
        state.correctProblems++;
        
        if (feedback) {
          feedback.innerHTML = `
            <i class="fas fa-check-circle"></i>
            <div>
              <strong>Correct!</strong> +${total} points
              <div style="font-size: 0.9rem; margin-top: 5px; opacity: 0.8;">
                Breakdown: Base ${base} + Time ${timeBonus} + Streak ${streakBonus}
              </div>
            </div>
          `;
          feedback.className = 'feedback correct';
        }
        
        updateStats();
        updateProgress();
        checkAchievements();
        
        // Create particle effect
        createParticles();
        
        // Auto next round after delay
        setTimeout(newRound, 2000);
      } else {
        // Wrong answer
        state.lives--;
        state.streak = 0;
        updateStats();
        
        if (feedback) {
          if (isTimeout) {
            feedback.innerHTML = `<i class="fas fa-clock"></i> <strong>Time's up!</strong> The answer was ${state.roundData.expected}.`;
            feedback.className = 'feedback incorrect';
          } else {
            feedback.innerHTML = `<i class="fas fa-times-circle"></i> <strong>Incorrect.</strong> The answer is ${state.roundData.expected}.`;
            feedback.className = 'feedback incorrect';
            if (answerInput) {
              answerInput.classList.add('shake');
              setTimeout(() => answerInput.classList.remove('shake'), 500);
            }
          }
        }
        
        if (state.lives <= 0) {
          endGame();
        } else {
          setTimeout(newRound, 2500);
        }
      }
    }

    function createParticles() {
      const particlesContainer = document.createElement('div');
      particlesContainer.style.position = 'fixed';
      particlesContainer.style.top = '0';
      particlesContainer.style.left = '0';
      particlesContainer.style.width = '100%';
      particlesContainer.style.height = '100%';
      particlesContainer.style.pointerEvents = 'none';
      particlesContainer.style.zIndex = '999';
      
      document.body.appendChild(particlesContainer);
      
      for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.style.position = 'absolute';
        particle.style.width = '10px';
        particle.style.height = '10px';
        particle.style.background = `hsl(${Math.random() * 60 + 200}, 100%, 65%)`;
        particle.style.borderRadius = '50%';
        particle.style.left = '50%';
        particle.style.top = '50%';
        particle.style.transform = 'translate(-50%, -50%)';
        
        particlesContainer.appendChild(particle);
        
        // Animate particle
        const angle = Math.random() * Math.PI * 2;
        const distance = 50 + Math.random() * 100;
        const duration = 800 + Math.random() * 400;
        
        particle.animate([
          { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 },
          { 
            transform: `translate(${Math.cos(angle) * distance - 50}%, ${Math.sin(angle) * distance - 50}%) scale(0)`,
            opacity: 0
          }
        ], {
          duration: duration,
          easing: 'cubic-bezier(0.2, 0.8, 0.2, 1)'
        });
      }
      
      // Remove container after animation
      setTimeout(() => {
        particlesContainer.remove();
      }, 1200);
    }

    function endGame() {
      if (feedback) {
        feedback.innerHTML = `
          <i class="fas fa-gamepad"></i>
          <div>
            <strong>Game Over!</strong> Final Score: ${state.score}
            <div style="font-size: 0.9rem; margin-top: 5px;">
              Correct: ${state.correctProblems}/${state.totalProblems}
            </div>
          </div>
        `;
        feedback.className = 'feedback info';
      }
      
      saveScore();
      if (drawBtn) drawBtn.disabled = true;
      
      setTimeout(() => {
        if (drawBtn) drawBtn.disabled = false;
        resetRound();
      }, 4000);
    }

    // Leaderboard system
    function loadLeaderboard() {
      const raw = localStorage.getItem('oc_leaderboard_enhanced');
      return raw ? JSON.parse(raw) : [];
    }

    function saveScore() {
      const name = (playerNameInput ? playerNameInput.value : 'Guest').slice(0, 20);
      const lb = loadLeaderboard();
      lb.push({
        name: name,
        score: state.score,
        date: new Date().toLocaleDateString(),
        difficulty: state.difficulty,
        problems: state.correctProblems
      });
      
      // Sort by score (descending)
      lb.sort((a, b) => b.score - a.score);
      
      // Keep only top 10
      const topScores = lb.slice(0, 10);
      localStorage.setItem('oc_leaderboard_enhanced', JSON.stringify(topScores));
      
      // Update player name in state
      state.playerName = name;
      
      renderLeaderboard();
    }

    function renderLeaderboard() {
      if (!lbList) return;
      
      const lb = loadLeaderboard();
      lbList.innerHTML = '';
      
      if (lb.length === 0) {
        lbList.innerHTML = `
          <li style="text-align: center; padding: 40px; color: var(--text-muted);">
            <i class="fas fa-trophy" style="font-size: 2rem; margin-bottom: 10px; display: block; opacity: 0.3;"></i>
            No records yet. Be the first!
          </li>
        `;
      } else {
        lb.forEach((entry, index) => {
          const li = document.createElement('li');
          const rankIcons = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰', '4ï¸âƒ£', '5ï¸âƒ£', '6ï¸âƒ£', '7ï¸âƒ£', '8ï¸âƒ£', '9ï¸âƒ£', 'ðŸ”Ÿ'];
          
          li.innerHTML = `
            <div class="player-rank">
              <div class="rank-icon">${rankIcons[index] || (index + 1)}</div>
              <div>
                <div style="font-weight: 800;">${entry.name}</div>
                <div style="font-size: 0.85rem; color: var(--text-muted);">
                  ${entry.date} â€¢ ${entry.difficulty}
                </div>
              </div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 1.5rem; font-weight: 800;">${entry.score}</div>
              <div style="font-size: 0.85rem; color: var(--text-muted);">
                ${entry.problems} correct
              </div>
            </div>
          `;
          
          lbList.appendChild(li);
        });
      }
    }

    // Player name handler
    if (savePlayerNameBtn && playerNameInput) {
      savePlayerNameBtn.addEventListener('click', () => {
        const name = playerNameInput.value.trim();
        if (name) {
          state.playerName = name.slice(0, 20);
          playerNameInput.value = state.playerName;
          localStorage.setItem('oc_player_name', state.playerName);
          showNotification('Player name saved!', 'success');
        }
      });
    }

    if (playerNameInput) {
      playerNameInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && savePlayerNameBtn) savePlayerNameBtn.click();
      });
    }

    // Reset leaderboard handler
    if (resetLeaderboardBtn) {
      resetLeaderboardBtn.addEventListener('click', () => {
        if (confirm('Are you sure you want to reset the leaderboard? All scores will be lost.')) {
          localStorage.removeItem('oc_leaderboard_enhanced');
          renderLeaderboard();
          showNotification('Leaderboard reset!', 'info');
        }
      });
    }

    // Allow Enter key to submit answer
    if (answerInput) {
      answerInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && submitBtn) submitBtn.click();
      });
    }

    // Initialize the game
    function init() {
      initStars();
      initAchievements();
      renderLeaderboard();
      renderAchievementDisplay();
      resetRound();
      
      // Load player name from localStorage
      const savedName = localStorage.getItem('oc_player_name');
      if (savedName && playerNameInput) {
        state.playerName = savedName;
        playerNameInput.value = savedName;
      }
      
      // Set initial power-up count
      if (powerupBtn) {
        powerupBtn.innerHTML = `<i class="fas fa-magic"></i> Power-up (${state.powerups})`;
      }
      
      // Set initial progress
      updateProgress();
      
      // Add keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        // Space to generate new scenario (when not typing)
        if (e.code === 'Space' && document.activeElement !== answerInput) {
          e.preventDefault();
          if (drawBtn) drawBtn.click();
        }
        
        // H for hint
        if (e.code === 'KeyH' && document.activeElement !== answerInput) {
          e.preventDefault();
          if (hintBtn) hintBtn.click();
        }
        
        // 1-4 for difficulty selection
        if (e.code >= 'Digit1' && e.code <= 'Digit4' && document.activeElement !== answerInput && diffSelect) {
          const index = parseInt(e.code.replace('Digit', '')) - 1;
          const options = Array.from(diffSelect.options);
          if (options[index]) {
            diffSelect.selectedIndex = index;
            diffSelect.dispatchEvent(new Event('change'));
          }
        }
      });
      
      // Save player name when changed
      if (playerNameInput) {
        playerNameInput.addEventListener('change', () => {
          localStorage.setItem('oc_player_name', playerNameInput.value);
        });
      }
    }

    // Start the game when DOM is loaded
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
